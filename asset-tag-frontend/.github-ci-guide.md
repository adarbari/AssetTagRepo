# Frontend CI/CD Best Practices Guide

This guide outlines the best practices for maintaining a stable and reliable frontend CI/CD pipeline.

## Required Versions

### Node.js and npm
- **Node.js**: >= 20.0.0 (specified in `.nvmrc` as 20.18.0)
- **npm**: >= 10.0.0 (required for lockfileVersion 3 support)

### Local Development Setup
1. Install Node.js 20.18.0 using nvm:
   ```bash
   nvm install 20.18.0
   nvm use 20.18.0
   ```

2. Or use the .nvmrc file:
   ```bash
   nvm use
   ```

## Dependency Management

### Adding New Dependencies
1. Install the package:
   ```bash
   npm install package-name
   ```

2. Commit both `package.json` and `package-lock.json`:
   ```bash
   git add package.json package-lock.json
   git commit -m "feat: add package-name dependency"
   ```

### Updating Dependencies
1. Check for outdated packages:
   ```bash
   npm outdated
   ```

2. Update specific packages:
   ```bash
   npm update package-name
   ```

3. Update all packages:
   ```bash
   npm update
   ```

4. Always commit the updated `package-lock.json`:
   ```bash
   git add package-lock.json
   git commit -m "chore: update dependencies"
   ```

### Regenerating package-lock.json
If you encounter issues with `package-lock.json`:

1. Delete the lock file and node_modules:
   ```bash
   rm package-lock.json
   rm -rf node_modules
   ```

2. Reinstall dependencies:
   ```bash
   npm install
   ```

3. Commit the new lock file:
   ```bash
   git add package-lock.json
   git commit -m "chore: regenerate package-lock.json"
   ```

## CI/CD Pipeline

### Workflow Structure
The CI pipeline consists of several jobs:

1. **test-fast**: Runs on pull requests with basic tests
2. **test-comprehensive**: Runs on main/develop branches with full test suite
3. **build**: Builds the frontend application
4. **coverage-report**: Generates and uploads test coverage reports

### Key Features
- **Version Verification**: Checks npm compatibility before installation
- **Security Audits**: Runs `npm audit` to detect vulnerabilities
- **Caching**: Uses npm cache to speed up builds
- **Working Directory**: Uses `working-directory` instead of `cd` commands
- **Error Handling**: Continues on non-critical failures

### Common CI Issues and Fixes

#### 1. LockfileVersion Compatibility Error
**Error**: `npm ci` fails with lockfileVersion compatibility issues

**Solution**: 
- Ensure Node.js 20.x is used (comes with npm 10.x)
- Check that `.nvmrc` file exists and specifies Node 20.18.0
- Verify `engines` field in `package.json` specifies npm >= 10.0.0

#### 2. Package-lock.json Not Found
**Error**: `npm ci` can't find package-lock.json

**Solution**:
- Ensure `package-lock.json` is committed to git
- Check that the file exists in the correct directory
- Verify the `cache-dependency-path` in workflow matches the actual path

#### 3. Wildcard Dependencies
**Error**: Inconsistent dependency versions

**Solution**:
- Replace wildcard dependencies (`"*"`) with specific versions
- Use `npm install` to update `package-lock.json` with exact versions
- Commit the updated lock file

#### 4. Security Vulnerabilities
**Error**: npm audit finds vulnerabilities

**Solution**:
- Review the audit report
- Update vulnerable packages:
  ```bash
  npm audit fix
  ```
- For breaking changes, update manually:
  ```bash
  npm install package-name@latest
  ```

## Automated Dependency Updates

### Dependabot Configuration
Dependabot is configured to automatically:
- Check for npm package updates weekly
- Check for pip package updates weekly  
- Check for GitHub Actions updates weekly
- Create pull requests for updates
- Label PRs appropriately

### Reviewing Dependabot PRs
1. Check the changelog for breaking changes
2. Run tests locally if needed
3. Review the diff for significant changes
4. Merge if tests pass and changes look good

## Security Best Practices

### Regular Security Audits
- Run `npm audit` before each release
- Address high and critical vulnerabilities immediately
- Monitor moderate vulnerabilities for updates

### Dependency Hygiene
- Keep dependencies up to date
- Remove unused dependencies
- Use exact versions for critical dependencies
- Review new dependencies for security history

## Troubleshooting

### Build Failures
1. Check the CI logs for specific error messages
2. Verify Node.js and npm versions match requirements
3. Ensure all dependencies are properly installed
4. Check for syntax errors in code

### Test Failures
1. Run tests locally to reproduce the issue
2. Check for environment-specific issues
3. Verify test data and mocks are up to date
4. Review recent changes that might affect tests

### Performance Issues
1. Check build times in CI logs
2. Verify caching is working properly
3. Consider splitting large test suites
4. Optimize dependency installation

## Contact and Support

For CI/CD issues:
1. Check this guide first
2. Review recent changes in the repository
3. Check GitHub Actions logs for detailed error messages
4. Create an issue if the problem persists

## Version History

- **v1.0.0**: Initial CI/CD setup with basic npm ci support
- **v2.0.0**: Added security audits, version verification, and improved error handling
- **v3.0.0**: Standardized to Node 20.x, added Dependabot, and comprehensive documentation
